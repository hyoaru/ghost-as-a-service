services:
  lambda:
    build: .
    container_name: ghost_as_a_service_lambda
    ports:
      - "9000:8080"
    environment:
      # Pulled from aws-vault
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_SESSION_TOKEN
      # From .env
      - POWERTOOLS_SERVICE_NAME=${POWERTOOLS_SERVICE_NAME}
      - POWERTOOLS_LOGGER_LOG_EVENT=${POWERTOOLS_LOGGER_LOG_EVENT}
      - POWERTOOLS_LOG_LEVEL=${POWERTOOLS_LOG_LEVEL}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    develop:
      watch:
        - action: sync+restart
          path: ./app
          target: /var/task/app
        - action: rebuild
          path: pyproject.toml
        - action: rebuild
          path: uv.lock
